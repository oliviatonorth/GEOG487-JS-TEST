<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>GEOG 487: Esri JavaScript Web Application</title>
  <h1>
    <img src="https://uofwaterloo-my.sharepoint.com/:i:/r/personal/s336park_uwaterloo_ca/Documents/GEOG%20487%20Web%20Mapping/University-of-Waterloo-Logo-Horizontal-1024x288.jpg?csf=1&web=1&e=dDq6CZ" alt="Image">
    Flood Risk Map of Fredericton, New Brunswick
  </h1>
  <style>
    h1 {
      margin: 0px;
      color: white;
      background-color: rgb(0, 121, 193);
      padding: 20px;
    }
    img {
      width: 120px; /* Adjust image width as needed */
      margin-right: 10px; /* Add some space between image and text */
    }
    /* Map */
    #viewDiv {
      height: calc(100vh - 20px);
      width: 100%;
      position: relative;
    }
    /* Layer List */
    #layerList {
      position: absolute;
      top: 10px;
      right: 10px;
      background-color: white;
      padding: 10px;
      border-radius: 5px;
      box-shadow: 0 0 5px rgba(0,0,0,0.3);
    }
    /* Toggle Button */
    #toggleLayerList {
      position: absolute;
      top: 10px;
      right: 10px;
      cursor: pointer;
      z-index: 1000; /* Ensure button appears above layer list */
    }
    #toggleLayerList img {
      width: 40px; /* Adjust icon size as needed */
    }
    /* Pop-Up Window */
    #popup {
      position: absolute;
      display: none;
      background-color: white;
      padding: 10px;
      border-radius: 5px;
      box-shadow: 0 0 5px rgba(0,0,0,0.3);
      z-index: 9999;
    }
    #popupContent {
      margin-bottom: 10px;
    }
    #closeButton {
      position: absolute;
      top: 5px;
      right: 5px;
      cursor: pointer;
    }
  </style>
  <link rel="stylesheet" href="https://js.arcgis.com/4.24/esri/themes/light/main.css">
  <script src="https://js.arcgis.com/4.24/"></script>
  <script>
    require([
      "esri/config",
      "esri/Map",
      "esri/views/MapView",
      "esri/layers/FeatureLayer",
      "esri/layers/TileLayer",
      "esri/widgets/LayerList"
    ], function(esriConfig, Map, MapView, FeatureLayer, TileLayer, LayerList) {

      // API key
      esriConfig.apiKey = "AAPK7286e3d2a7e9491ab1df9a0901a9753bTV_uMAgvXjTJPy7dBJ6Xm3aZdSuQZNdDwSWpurmrxGMiggV1BCQmqmfx2gQ9SYkg";

      // Create a map centered on Fredericton
      var map = new Map({
        basemap: "topo-vector"
      });

      var view = new MapView({
        container: "viewDiv",
        map: map,
        center: [-66.6475, 45.9500],
        zoom: 12
      });

      // Add the city boundary layer
      var cityBoundaryLayer = new FeatureLayer({
        url: "https://services2.arcgis.com/iLWAxhpxafhOza2U/arcgis/rest/services/CityBoundaryOD/FeatureServer/14/query?outFields=*&where=1%3D1&f=geojson"
      });
      map.add(cityBoundaryLayer);

      // Add the Critical Infrastructure layer
      var Critical_Infrastructure = new FeatureLayer({
        url: "https://services1.arcgis.com/56dETZIzFXStwLka/arcgis/rest/services/Lower_Wolastoq_Flooding___Assets_WFL1/FeatureServer/1"
      });
      Critical_Infrastructure.visible = false;
      map.add(Critical_Infrastructure);

      // Add the 1973 Flood Extent
      var Flood_Extent_1973 = new FeatureLayer({
        url: "https://services1.arcgis.com/56dETZIzFXStwLka/arcgis/rest/services/Lower_Wolastoq_Flooding___Assets_WFL1/FeatureServer/9",
      renderer: {
        type: "simple",  // Use a simple renderer
        symbol: {
            type: "simple-fill",  // Use a simple fill symbol
            color: [40, 166, 224, 0.9],  // 1973 Fill Color
            outline: {
                color: [0, 0, 0],  // Outline Color
                width: 1  // Outline width
            }
        }
      }
      });
      Flood_Extent_1973.visible = false;
      map.add(Flood_Extent_1973);

      // Add the 2008 Flood Extent
      var Flood_Extent_2008 = new FeatureLayer({
        url: "https://services1.arcgis.com/56dETZIzFXStwLka/arcgis/rest/services/Lower_Wolastoq_Flooding___Assets_WFL1/FeatureServer/8",
      
      renderer: {
        type: "simple",  // Use a simple renderer
        symbol: {
            type: "simple-fill",  // Use a simple fill symbol
            color: [119, 191, 224],  // 2008 Fill Color
            outline: {
                color: [0, 0, 0],  // Outline Color
                width: 1  // Outline width
            }
        }
      }
      });
      Flood_Extent_2008.visible = false;
      map.add(Flood_Extent_2008);

      // Add the 2018 Flood Extent
      var Flood_Extent_2018 = new FeatureLayer({
        url: "https://services1.arcgis.com/56dETZIzFXStwLka/arcgis/rest/services/Lower_Wolastoq_Flooding___Assets_WFL1/FeatureServer/7",
      renderer: {
        type: "simple",  // Use a simple renderer
        symbol: {
            type: "simple-fill",  // Use a simple fill symbol
            color: [204, 227, 237],  // 2018 Fill Color
            outline: {
                color: [0, 0, 0],  // Outline Color
                width: 1  // Outline width
            }
        }
      }
      });
      Flood_Extent_2018.visible = false;
      map.add(Flood_Extent_2018);

      // Add the Flood Susceptability Layer
      var TileLayer = require("esri/layers/TileLayer");
      var Flood_Susceptability = new TileLayer({
        url: "https://tiles.arcgis.com/tiles/56dETZIzFXStwLka/arcgis/rest/services/Lower_Wolastoq_Flooding___Assets_WTL1/MapServer",
        opacity: 0.5
      });
      map.add(Flood_Susceptability);

      map.reorder(cityBoundaryLayer, map.layers.length - 1);

      // Add the LayerList widget
      var layerList = new LayerList({
        view: view,
        container: "layerList"
      });

      view.ui.add(layerList, "top-right");

      // Show layer information in a popup at cursor position
      function showPopup(event, layer) {
        var clickedFeature = event.features[0];
        var popup = document.getElementById("popup");
        var popupContent = document.getElementById("popupContent");
        var closeButton = document.getElementById("closeButton");

        var attributes = clickedFeature.attributes;

        // Pop-Up Window
        var contentHTML = "<h3>Feature Information</h3>";
        Object.keys(attributes).forEach(function(key) {
          contentHTML += "<p><b>" + key + ":</b> " + attributes[key] + "</p>";
        });

        popupContent.innerHTML = contentHTML;
        popup.style.display = "block";
        popup.style.left = event.x + "px";
        popup.style.top = event.y + "px";

        closeButton.onclick = function() {
          popup.style.display = "none";
        };
      }

      // Add click event to the map to show layer information
      view.on("click", function(event) {
        view.hitTest(event).then(function(response) {
          response.results.some(function(result) {
            if (result.graphic.layer.type === "feature") {
              showPopup({ features: [result.graphic], x: event.x, y: event.y }, result.graphic.layer);
              return true;
            }
          });
        });
      });

      // Toggle layer list visibility
      var toggleButton = document.createElement("button");
      toggleButton.id = "toggleLayerList";
      toggleButton.style.position = "absolute";
      toggleButton.style.top = "20px";
      toggleButton.style.right = "20px";
      toggleButton.style.backgroundColor = "transparent";
      toggleButton.style.padding = "0";
      toggleButton.style.border = "none";
      toggleButton.style.zIndex = "1000";
      toggleButton.innerHTML = '<img src="https://uofwaterloo-my.sharepoint.com/:i:/r/personal/s336park_uwaterloo_ca/Documents/GEOG%20487%20Web%20Mapping/Icon_Layers.jpg?csf=1&web=1&e=JmqJ8y" alt="Layer List Icon" width="40">';
      document.body.appendChild(toggleButton);

      var layerListContainer = document.getElementById("layerList");
      toggleButton.addEventListener("click", function() {
        if (layerListContainer.style.display === "none") {
          layerListContainer.style.display = "block";
        } else {
          layerListContainer.style.display = "none";
        }
      });

    });
  </script>
</head>
<body>
  <div id="viewDiv">
    <div id="popup">
      <span id="closeButton">&times;</span>
      <div id="popupContent"></div>
    </div>
  </div>
  <div id="layerList"></div>
</body>
</html>
